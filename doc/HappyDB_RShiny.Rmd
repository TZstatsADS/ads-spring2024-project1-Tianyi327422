---
title: "What Makes Women Happy"
author: "Tianyi Jiang"
output: html_notebook
runtime: shiny
---

HappyDB is a corpus of 100,000 crowd-sourced happy moments via Amazon's Mechanical Turk. You can read more about it on <https://arxiv.org/abs/1801.07746>.

Here, we explore this data set and try to answer the question, "What makes people happy?"

### Step 0 - Load all the required libraries

```{r load libraries, warning=FALSE, message=FALSE}

library(tidyverse)
library(tidytext)
library(DT)
library(scales)
library(wordcloud)
library(gridExtra)
library(ngram)
library(shiny) 
library(tm)
```

### Step 1 - Load the processed text data along with demographic information on contributors

```{r load data, warning=FALSE, message=FALSE}
hm_data <- read_csv("../output/processed_moments.csv")

urlfile<-'https://raw.githubusercontent.com/rit-public/HappyDB/master/happydb/data/demographic.csv'
demo_data <- read_csv(urlfile)
```

### Combine both the data sets and keep the required columns for analysis

We select a subset of the data that satisfies specific row conditions.

```{r combining data, warning=FALSE, message=FALSE}
hm_data <- hm_data %>%
  inner_join(demo_data, by = "wid") %>%
  select(wid,
         original_hm,
         gender, 
         marital, 
         parenthood,
         reflection_period,
         age, 
         country, 
         ground_truth_category, 
         text) %>%
  mutate(count = sapply(hm_data$text, wordcount)) %>%
  filter(gender %in% c("m", "f")) %>%
  filter(marital %in% c("single", "married")) %>%
  filter(parenthood %in% c("n", "y")) %>%
  filter(reflection_period %in% c("24h", "3m")) %>%
  mutate(reflection_period = fct_recode(reflection_period, 
                                        months_3 = "3m", hours_24 = "24h"))
```

### Question 1:Does Marriage Bring Happiness to Women

The impact of marriage on women's happiness is indeed a multifaceted issue, and everyone's experiences and feelings are different. When analyzing this topic, we can consider some interesting phenomena and reasons.

Firstly, the happiness that marriage brings is often derived from sharing "happy moments" in life with a partner. These moments can include romantic times spent together, the achievement of shared dreams, or the process of raising children. These precious moments can increase a woman's sense of happiness and strengthen their emotional connection.

On the other hand, marriage may bring some stress and challenges, especially in terms of family responsibilities. However, it can also stimulate women's inner strength and coping abilities. They may learn to better manage their time, handle conflicts, and build closer intimate relationships.

Furthermore, societal expectations regarding marriage can sometimes create pressure for women. However, modern society increasingly emphasizes personal freedom and choice. Women have more opportunities to decide their own marriage and lifestyle, which helps alleviate the impact of societal pressure.

Most importantly, happiness is subjective, and different people have different definitions of it. Some women may consider marriage as the source of their happiness, while others may feel that the single life better suits their expectations. The reason for caring about this issue is that we hope every woman can make a genuine choice between marriage and singlehood and live the life they truly desire because happiness is the ultimate goal! Therefore, I hope to objectively analyze the impact of marriage on women's happiness by examining the concept of "happy moments." In the following analysis, I categorize women with both marriage and divorce experiences into one group.

```{r,echo=FALSE}
married_female <- hm_data[hm_data$gender == "f" & (hm_data$marital == "married" | hm_data$marital == "divorced"),]
unmarried_female <- hm_data[hm_data$gender == "f" & hm_data$marital == "single",]
hm_data_female <- hm_data[hm_data$gender=="f",]
```

Create a new column 'marital_status_group' by grouping 'married' and 'divorced' together

```{r,echo=FALSE}
hm_data_female <- hm_data_female %>%
  mutate(marital_status_group = ifelse(marital %in% c("married", "divorced"), "married_or_divorced", marital))
```

Create a data frame for word frequency

```{r,echo=FALSE}
word_count_female <- hm_data_female %>%
  unnest_tokens(word, text) %>%
  count(marital_status_group, word, sort = TRUE) %>%
  group_by(marital_status_group) %>%
  mutate(proportion = n / sum(n)) %>%
  select(-n) %>%
  spread(marital_status_group, proportion)
```

Create a plot

```{r,warning=FALSE, message=FALSE,echo=FALSE}
ggplot(word_count_female, aes(x = single, y = married_or_divorced)) +
  geom_abline(color = "gray40", lty = 2) +
  geom_jitter(alpha = 0.1, size = 1, width = 0.3, height = 0.3) +
  labs(title="Words Proportion for marital status (married/divorced vs. single)") +
  geom_text(aes(label = word), check_overlap = TRUE, vjust = 1.5) +
  scale_x_log10(labels = scales::percent_format()) +
  scale_y_log10(labels = scales::percent_format()) +
  scale_color_gradient(limits = c(0, 0.001), low = "darkslategray4", high = "gray75") +
  theme(legend.position = "none")
```

Create a word frequency data frame for married/divorced females

```{r,message=FALSE,warning=FALSE,echo=FALSE}
bag_of_words_married_divorced <- married_female %>%
  unnest_tokens(word, text)
word_count_married_divorced <- bag_of_words_married_divorced %>%
  count(word, sort = TRUE)
```

Generate a word cloud for married/divorced females

```{r, warning=FALSE,message=FALSE,echo=FALSE}
wordcloud(word_count_married_divorced$word, word_count_married_divorced$n,
          scale=c(3, 0.1),
          max.words=100,
          min.freq=1,
          random.order=FALSE,
          rot.per=0.3,
          use.r.layout=TRUE,
          random.color=FALSE,
          colors=brewer.pal(9, "Oranges"),
          main="Word Cloud for Married/Divorced Females")
```

Create a word frequency data frame for single females

```{r, warning=FALSE,message=FALSE,echo=FALSE}
bag_of_words_single <- unmarried_female %>%
  unnest_tokens(word, text)
word_count_single <- bag_of_words_single %>%
  count(word, sort = TRUE)
```

Generate a word cloud for single females

```{r, warning=FALSE,message=FALSE,echo=FALSE}
wordcloud(word_count_single$word, word_count_single$n,
          scale=c(3, 0.1),
          max.words=100,
          min.freq=1,
          random.order=FALSE,
          rot.per=0.3,
          use.r.layout=TRUE,
          random.color=FALSE,
          colors=brewer.pal(9, "Oranges"),
          main="Word Cloud for Single Females")
```

```{r,warning=FALSE, message=FALSE,echo=FALSE}
 word_count_married_divorced[1:15,] %>%
      mutate(word = reorder(word, n)) %>%
      ggplot(aes(word, n)) +
      geom_col() +
      labs(title = "Word Frequency in Married and Divorced Women") +
      xlab(NULL) +
      ylab("Word Frequency") +
      coord_flip()
```

```{r,warning=FALSE, message=FALSE,echo=FALSE}
 word_count_single[1:15,] %>%
      mutate(word = reorder(word, n)) %>%
      ggplot(aes(word, n)) +
      geom_col() +
      labs(title = "Word Frequency in Single Women") +
      xlab(NULL) +
      ylab("Word Frequency") +
      coord_flip()

```

From the above two word clouds and plots, we can observe that women tend to emphasize moments of happiness related to friends, daily life, and time when they are unmarried. However, once they get married, they start experiencing new moments of happiness with their husband, sons, family, and daughters.

When unmarried, women often find happiness in the beautiful moments spent with friends, enjoying everyday life, and having ample time to pursue personal interests and hobbies. These moments highlight freedom and independence, allowing them to savor life on their own terms.

On the other hand, once they tie the knot, women begin to experience special moments of happiness shared with their husband. With a husband, they can share romantic moments, make family plans together, and jointly shoulder the responsibilities of life. Furthermore, after marriage, the arrival of sons and daughters can bring new family joys, such as quality parent-child time and the happiness of witnessing their children's growth.

In marriage, the importance of family and bonds become more pronounced. Women start to experience moments of celebrating holidays with family members, facing challenges together, and providing mutual support. These new moments of happiness underscore the warmth of family and the preciousness of familial love.

In summary, women may experience shifts in the moments of happiness they cherish at different stages of life, with an emphasis on freedom and friendship during singledom, and a focus on partner relationships and family happiness after marriage. These changes reflect the varying impact of marriage on women's lives, with each stage having its unique aspects.

### Question 2:Friends and boyfriends bring experiences of happiness to single women

Friends and boyfriends play significant roles in the happy moments of single women. Friends provide unparalleled companionship and support to single women. Friends are companions who are there during moments of loneliness, sharing the ups and downs of life together. They offer emotional support, lend a listening ear, share laughter, and keep secrets, all of which make single women feel warm and happy. Boyfriends bring the sweetness of romance and love. They give single women a unique feeling, bringing passion, romantic dates, and deep emotional connections that come with love. Boyfriends are companions and supporters, and together they create precious memories and beautiful moments.

Create a new data frame named hm_data_young_specific_words that includes happy moments mentioning specific words

```{r,warning=FALSE, message=FALSE,echo=FALSE}
hm_data_single_specific_words <- unmarried_female %>%
  filter(grepl("friend", text) |
         grepl("boyfriend", text))

nrow(hm_data_single_specific_words)

```

```{r,warning=FALSE, message=FALSE,echo=FALSE}

bag_of_words_single <-  hm_data_single_specific_words %>%
  unnest_tokens(word, text)

word_count_single <- bag_of_words_single %>%
  count(word, sort = TRUE)

word_count_single<- word_count_single[-c(which(word_count_single$word=="friend"),which(word_count_single$word=="boyfriend")),]

word_count_single[1:20,] %>%
      mutate(word = reorder(word, n)) %>%
      ggplot(aes(word, n)) +
      geom_col() +
      xlab(NULL) +
      ylab("Word Frequency")+
      coord_flip()
wordcloud(word_count_single$word,word_count_single$n ,
          scale=c(3,0.1),
          max.words=100,
          min.freq=1,
          random.order=FALSE,
          rot.per=0.3,
          use.r.layout=T,
          random.color=FALSE,
          colors=brewer.pal(9,"Accent"))
```

From the plot and word cloud above, we can see that the moments of happiness for single women brought by friends and boyfriends often involve the key words "day" and "time" being mentioned most frequently. Additionally, we can also observe some other related words, such as "birthday," "talked," "moment," and "dinner."

These words reflect some characteristics of the lives of single women. "day" and "time" emphasize their ability to freely manage their time, enjoying their day, and pursuing personal interests and joys. "birthday" may represent the moments of happiness when they celebrate special occasions, without necessarily relying on a partner.

"talked" indicates the importance of communication with friends and boyfriends in their happiness, which may include chatting with friends, sharing emotions, or spending intimate moments with boyfriends. "moment" highlights the cherished beautiful moments, which could be special experiences, moments of inspiration, or laughter.

"dinner" implies that single women may enjoy the time spent having dinner with friends or boyfriends, which is a way to build and maintain relationships and an opportunity to share enjoyable moments.

### Question 3:Are Happiness Factors Similar for Women of Different Age Groups

Create a new "age_group" column based on age to categorize women into three groups

```{r,warning=FALSE, message=FALSE,echo=FALSE}
hm_data_female <- hm_data_female %>%
  mutate(age_group = case_when(
    age < 30 ~ "young",
    age >= 30 & age < 60 ~ "middle-aged",
    age >= 60 ~ "elderly"
  ))
```

Create data frames for different age groups and word frequency

```{r,warning=FALSE, message=FALSE,echo=FALSE}
bag_of_words_young <-  hm_data_female %>%
  filter(age_group == "young") %>%
  unnest_tokens(word, text)
word_count_young <- bag_of_words_young %>%
  count(word, sort = TRUE)

bag_of_words_middle_aged <-  hm_data_female %>%
  filter(age_group == "middle-aged") %>%
  unnest_tokens(word, text)
word_count_middle_aged <- bag_of_words_middle_aged %>%
  count(word, sort = TRUE)

bag_of_words_elderly <-  hm_data_female %>%
  filter(age_group == "elderly") %>%
  unnest_tokens(word, text)
word_count_elderly <- bag_of_words_elderly %>%
  count(word, sort = TRUE)
```

Create word clouds for different age groups

```{r,warning=FALSE, message=FALSE,echo=FALSE}
wordcloud(word_count_young$word, word_count_young$n,
          scale=c(3,0.1),
          max.words=100,
          min.freq=1,
          random.order=FALSE,
          rot.per=0.3,
          use.r.layout=TRUE,
          random.color=FALSE,
          colors=brewer.pal(9,"Oranges"),
          main="Word Cloud for Young Women")
```

```{r,warning=FALSE, message=FALSE,echo=FALSE}
wordcloud(word_count_middle_aged$word, word_count_middle_aged$n,
          scale=c(3,0.1),
          max.words=100,
          min.freq=1,
          random.order=FALSE,
          rot.per=0.3,
          use.r.layout=TRUE,
          random.color=FALSE,
          colors=brewer.pal(9,"Oranges"),
          main="Word Cloud for Middle-Aged Women")
```

```{r,warning=FALSE, message=FALSE,echo=FALSE}
wordcloud(word_count_elderly$word, word_count_elderly$n,
          scale=c(3,0.1),
          max.words=100,
          min.freq=1,
          random.order=FALSE,
          rot.per=0.3,
          use.r.layout=TRUE,
          random.color=FALSE,
          colors=brewer.pal(9,"Oranges"),
          main="Word Cloud for Elderly Women")
```

Plot word frequency bar chart for the young age group

```{r,warning=FALSE, message=FALSE,echo=FALSE}
word_count_young[1:15,] %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n)) +
  geom_col() +
  labs(title = "Word Frequency in Young Women") +
  xlab(NULL) +
  ylab("Word Frequency") +
  coord_flip()
```

Plot word frequency bar chart for the middle-aged age group

```{r,warning=FALSE, message=FALSE,echo=FALSE}
word_count_middle_aged[1:15,] %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n)) +
  geom_col() +
  labs(title = "Word Frequency in Middle-Aged Women") +
  xlab(NULL) +
  ylab("Word Frequency") +
  coord_flip()
```

Plot word frequency bar chart for the elderly age group

```{r,warning=FALSE, message=FALSE,echo=FALSE}
word_count_elderly[1:15,] %>%
  mutate(word = reorder(word, n)) %>%
  ggplot(aes(word, n)) +
  geom_col() +
  labs(title = "Word Frequency in Elderly Women") +
  xlab(NULL) +
  ylab("Word Frequency") +
  coord_flip()
```

Young women often mention "day" and "time" in their happy moments, which may reflect the importance they place on enjoying each day, having control over their time, and leading fulfilling lives. Additionally, "friend" is a significant element in their lives, highlighting the value of social connections and friendships.

Middle-aged women, in addition to emphasizing "day" and "time" in their happy moments, also frequently mention "husband," "daughter," and "son." This reflects their increased focus on family, familial bonds, and the importance of their partner relationships.

Similarly, older women in their happy moments also emphasize "day" and "time," but they also highlight "husband" and "friend." This suggests that they continue to value interactions with their partners and friends while possibly placing a greater emphasis on cherishing the happiness of each day.

These vocabulary differences across different age groups reflect the changing priorities and significance of various aspects of life for women at different stages, from the freedom and friendship of youth to the family and bonds of middle age, and to the appreciation of everyday happiness in old age.
